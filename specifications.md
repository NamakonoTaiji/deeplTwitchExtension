# Twitch DeepL Translator 仕様書

## 1. プロジェクト概要

### 1.1 目的
Twitchの英語コメントをリアルタイムで検出し、DeepL APIを使用して日本語に翻訳するChrome拡張機能を開発する。

### 1.2 主要機能
- Twitchチャット内の英語コメントをリアルタイムで検出
- DeepL APIを使用した英語から日本語への翻訳
- 翻訳結果をオリジナルコメントの下に表示
- 拡張機能の有効/無効を切り替える機能
- DeepL APIキーを設定・保存する機能

## 2. システム構成

### 2.1 コンポーネント
1. **コンテンツスクリプト (content.js)**
   - Twitchページに挿入され、DOM操作を行う
   - MutationObserverを使用してコメントの追加を監視
   - コメント要素の解析と翻訳対象の特定
   - 翻訳結果の表示

2. **バックグラウンドスクリプト (background.js)**
   - DeepL APIとの通信
   - 翻訳リクエストの管理とレスポンス処理

3. **ポップアップUI (popup.html/js)**
   - 拡張機能の有効/無効切り替え
   - 現在の状態表示

4. **オプションページ (options.html/js)**
   - DeepL APIキーの設定と保存
   - その他の詳細設定（将来的な拡張用）

### 2.2 データフロー
1. コンテンツスクリプトがTwitchチャットの新規コメントを検出
2. 英語コメントが検出された場合、バックグラウンドスクリプトに翻訳リクエストを送信
3. バックグラウンドスクリプトがDeepL APIに翻訳リクエストを送信
4. 翻訳結果をコンテンツスクリプトに返送
5. コンテンツスクリプトが翻訳結果をコメントの下に表示

## 3. 詳細機能仕様

### 3.1 コメント検出
- MutationObserverを使用してチャットコンテナのDOM変更を監視
- 新しいコメント要素が追加されたときに検出
- コメントのテキスト内容を抽出
- 英語コメントの判定（シンプルな実装として、非日本語をすべて翻訳対象とする方法も考慮）

### 3.2 DeepL API連携
- APIキーを使用した認証
- 翻訳リクエストの送信（HTTPリクエスト）
- レスポンスの処理と翻訳テキストの抽出
- エラーハンドリング（APIキー無効、クォータ超過など）
- レート制限対応（リクエスト頻度の制御）

### 3.3 翻訳表示
- オリジナルコメントの下に翻訳テキストを追加
- 視覚的に区別可能なスタイリング
- 翻訳中の状態表示（オプション）

### 3.4 設定機能
- DeepL APIキーの設定と保存（Chrome Storage APIを使用）
- 拡張機能の有効/無効状態の保存
- 将来的な拡張のための設定オプション（翻訳対象言語の選択など）

## 4. ユーザーインターフェース

### 4.1 ポップアップUI
- シンプルなON/OFFトグルスイッチ
- 現在の状態表示
- オプションページへのリンク

### 4.2 オプションページ
- DeepL APIキー入力フォーム
- 設定保存ボタン
- 設定状態の表示

### 4.3 Twitchページ内表示
- オリジナルコメントの下に翻訳テキストを表示
- 翻訳テキストは異なる色や前置きテキストで区別

## 5. 技術要件

### 5.1 使用技術
- JavaScript (ES6+)
- Chrome Extension API
- MutationObserver API
- DeepL API
- Chrome Storage API
- Fetch API または XMLHttpRequest

### 5.2 ブラウザ互換性
- Google Chrome 最新版

### 5.3 パフォーマンス要件
- 低レイテンシー翻訳処理（可能な限り）
- メモリ使用量の最適化
- DeepL API使用量の効率化（無駄なリクエストの防止）

## 6. 制限事項と将来的な拡張

### 6.1 制限事項
- 英語→日本語の翻訳のみ対応（初期バージョン）
- DeepL APIの無料プランの場合、月間翻訳文字数に制限あり
- Twitchのページ構造変更に脆弱な可能性

### 6.2 将来的な拡張
- 複数言語対応
- 自動言語検出機能
- 翻訳フィルター（特定ユーザーや単語のスキップ）
- 翻訳履歴機能
- 翻訳精度向上のためのカスタム辞書

## 7. 開発スケジュール

### フェーズ1: 基本構造の実装
- プロジェクト設定と基本構造の作成
- manifest.jsonの設定
- 拡張機能アイコンと基本UIの作成

### フェーズ2: コメント検出機能の実装
- MutationObserverの設定
- コメント要素の検出とテキスト抽出ロジックの実装

### フェーズ3: DeepL API連携の実装
- API通信機能の実装
- レート制限とエラーハンドリングの実装

### フェーズ4: 翻訳表示UIの実装
- 翻訳テキスト表示のスタイリング
- アニメーションや状態表示の実装

### フェーズ5: 設定ページの実装
- オプションページの作成
- 設定の保存と読み込み機能の実装

### フェーズ6: テストと改善
- 機能テスト
- パフォーマンス最適化
- バグ修正

### フェーズ7: パッケージング
- Chrome Web Storeへの公開準備
- 説明やスクリーンショットの作成
